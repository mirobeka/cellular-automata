import sys, os
ca_directory = os.getcwd()
if ca_directory not in sys.path:
  sys.path.insert(0, ca_directory) # adds path to cellular automata package

from cellular_automata.lattices.equiangular import SquareLattice
from cellular_automata.lattices.neighbourhoods import VonNeumann
from cellular_automata.rules.neural_rule import ANNColorRule
from cellular_automata.visualization.tkinter_visualization import LatticeWidget
from cellular_automata.visualization.tkinter_visualization import SimpleGUI
from cellular_automata.states.base import ChemicalInternalGrayscaleState
from Tkinter import Tk
import tkColorChooser
import yaml
import numpy as np

class SquareLatticeWidget(LatticeWidget):
  def map_state_to_rgb(self, state):
    return "#{val:02X}{val:02X}{val:02X}".format(val=state.grayscale)

  def set_cell_state(self, event):
    item_id = self.find_closest(event.x, event.y)[0]
    cell = self.lattice.canvas_item_ids[item_id]
    rgb,color_hex = tkColorChooser.askcolor("white", title="choose cells state")
    if rgb is None:
      return
    self.itemconfig(item_id, fill=color_hex)
    cell.state.grayscale = rgb[0]

class GUISquareLatticeTest(SimpleGUI):
  def initialize_lattice(self):
    dimensions = (512, 512)
    rule = ANNColorRule()
    rule.set_weights(self.get_weights())
    self.lattice = SquareLattice.create_initialized(
        dimensions=dimensions,
        neighbourhood=VonNeumann,
        resolution=8,
        state=ChemicalInternalGrayscaleState,
        rule=rule)
  
  def get_weights(self):
    return np.array([
-0.88314195181,2.6694382742,2.51327779592,2.02567955219,-0.499966008871,-2.1229021335,0.165927631629,2.01105273997,-0.929949232729,-1.42768959455,0.998354442853,-1.8322264608,0.429213069626,-2.15848186338,-1.13392459563,-0.42248716678,-0.415218400901,-1.49247673768,-2.70243082979,1.53755251847,-3.52739942806,-1.11467561281,0.473051664375,0.248840249804,0.679545636647,-1.52872477147,0.443614420177,2.44932239669,-3.03491118327,-1.0092502126,-1.99425312204,-2.25670752328,-1.12933984225,2.87347501068,1.54396605262,-2.72776000905,1.99714322838,3.86682632417,-2.37950232434,-0.466291169588,1.50114689189,0.49462677594,3.6640818327,-0.875840667609,-0.595901555915,3.45577810217,3.15367295361,-0.78816026657,-3.03992514545,1.66412416607,1.48084575423,-0.538007809302,2.99346873793,2.60074028635,-0.719416811846,-1.36423764299,1.88299327839,-1.69336439607,-1.58889587831,-0.15847820557,0.0256155068456,1.08604940105,-0.969749473203,0.683264011788,-0.538568247664,-0.0853465682607,1.48757060084,2.05607099191,-2.30159120519,-0.921796770405,-1.71754851953,-4.41497955072,-2.17471474609,-0.0160950245371,-1.29665954642,-0.742514954287,-2.67077517903,0.35194033095,-0.875123810799,-1.7486585077,-1.81962720482,3.61087772317,0.075273152746,1.68749179342,-3.05423581765,2.86639576782,-1.68191743702,0.119107079567,2.11882197454,-2.95574917967,-1.58110095334,1.44321955149,1.5337910205,-1.35499055314,0.53018726012,1.36718366338,-0.401028010886,1.03888262911,1.91354214255,0.681442461189,-1.45273003297,-0.408507975624,2.25906742188,-3.74719810201,-0.114487548753,-1.07207759681,-0.440372950547,0.584871446377,0.985477010216,-2.339445781,2.03181288183,-0.637550251707,-1.0868342967,3.0243943696,0.63245838155,-1.39892263479,-1.24743900731,-2.00680905045,-1.88694353556,0.0954458475477,-0.612296953181,-1.97740800153,2.4781747394,1.38736191284,-0.438640405706,0.178830754373,0.711336824663,-0.845991174292,1.30551062518,-0.691059257064,0.302477197984,-2.31382342447,3.47501340594,-2.69653075449,0.884886825278,2.2379844729,-0.954975470655,0.858918929133,-0.270888655359,0.636537888357,2.4576990805,-0.477162902761,-1.21839520067,1.04379551443,-2.77257751218,1.16588152763,-1.45642892889,2.19409448591,1.27532087258,0.346267616705,-1.151981272,-1.79781360768,-0.752407206736,-1.22521137029,2.93007131722,-1.70665133258,-2.17070921617,-0.150301424903,-1.97102934691,-3.55355008471,-0.935842437752,0.783802665676,1.20456312073,-3.26182788141,-0.554646896779,1.7886627576,-0.651359341496,-0.122199372134,-0.723544281827,0.840954532646,-0.767100524053,2.51012756511,-1.17048369906,-1.18999983295,0.0796686433137,0.0324363589314,-0.480443638289,0.948896866974,-0.622067961064,-1.70041469483,1.07960950905,3.52728634811,-1.21608351025,1.01605767391,-0.0823629528323,-1.78473814826,2.14273490413,4.44252305832,1.59612180944,-2.22567057129,-0.13662138179,-3.07231342577,-1.24712113661,1.19635704788,0.142499765057,-1.50506138054,1.62147878791,-1.04983691615,1.61957659311,3.2207636284,4.19659886366,-0.870834834326,1.21391215605,-0.581088334384,-0.273093800583,-2.94311748877,-1.11574486711,-1.24325151786,2.19199162541,3.33253247425,0.102049044886,1.16594940664,-1.90428350795,-2.71751223271,-2.79602849944,-3.1934046376,1.24737548847,-1.82052443093,0.427061138784,-0.928860489931,1.42227025559,-0.251066584065,-0.675628664396,-0.667866935937,2.18220124113,3.32040790553,-0.586648941925,-1.18054373481,0.472337255246,-0.534370053695,-0.707240832151,1.57667299272,-0.855432815398,-1.91266897375,1.38567685497,-0.346368493308,-0.712840895055,-1.00892440704,1.27722505319,0.149450820585,0.0364527887542,1.12425505159,1.91731221153,-0.684398694111,1.80629868902,0.315285748344,1.54905682811,0.183431157503,-0.33940112354,-0.588418508974,0.500634722723,-3.19773241112,2.8534619775,1.30315626907,0.94182931343,0.720682988472,-1.35303661501,-0.277892475706,-0.833618454991,0.286135044113,-0.726605528014,0.457278124895,0.27301244896,-1.21766871988,0.525265679991,1.89131739821,0.0962996699197,-2.74702832029,0.79131834644,-0.177950375969,-3.00444577044,-0.59366210419,1.5033335258,-1.4689319768,0.5550916405,2.38598021313,0.539081358112,1.76879135232,1.58889405274,-2.36883486045,-0.79626375609,1.87763290778,-1.41080563547,1.05568350101,0.457718443857,-1.7360776441,1.89319808227,-0.349380701137,0.27091779747,3.54257106012,1.37626863299,0.419953969036,-0.604255224132,-0.599558681559,-1.36586359793,0.0670155287072,-0.791447381729,-1.61714004704,-0.45255825366,-0.0687036920079,-2.79281113458,0.861075312415,-3.29223933706,-1.55508009381,-0.37579688082,1.04560807305,-0.102372089608,-0.0344407783198,4.50554900597,-3.37563037042,-1.74841188182,2.95305966768,-2.85488011408,2.37142490048,-1.18907993009,-1.68450591424,-0.0449310248974,2.06099302335,-0.0414236259299,-3.18256048154,1.52011044916,-2.87108402724,-1.75860192889,-1.36608325205,-1.58380615285,4.15626691446,-0.728153652421,-3.76342439623,-0.810033913346,2.05848552733,0.921484736848,0.377453647093,2.57820650553,2.58355427345,-3.37356489721,-2.34034754158,-2.20527032375,-3.06064880929,0.141693272056,-1.71204863514,0.858722195738,0.363323540396,1.83004587084,1.70880729738,-1.16366953202,0.122967906541,-0.229515919546,1.33891893922,-3.84992698163,1.70949671028,2.29285158342,2.32509834918,-1.13915235456,-0.495352297038,-0.695630998213,0.22575412005,-0.22062790462,-0.8692977455,-1.29475448302,0.246215585034,3.52663812034,-0.159268433347,1.28997660997,-0.222370501789,-0.796046076745,-1.64835642669,0.0234431957711,-1.20483824677,-2.07744092884,3.74561048141,-1.85526256488,0.655873027521,-0.548139568966,2.99069057578,0.332620578447,-0.653906750246,0.305576028652,1.59715833391,0.712787539936,-2.12536702237,0.37749477014,1.12030840498,-1.37661096559,-0.841138352828,1.99267533983,-1.33341231779,-0.18843743274,3.94422385768,-0.250687397163,-1.2892096514,-1.12955483973,-0.825359304048,-2.33798961452,0.482196813319,1.34375642251,1.26364327999,1.33497760611,0.0171068743759,-0.660766288638,-2.57620924226,0.0703899227014,-0.241920729327,0.188352790541,0.571240678226,-2.12944449574,0.866559296957,1.44932046539,1.16181401845,1.01491758184,3.41310702956,-1.22551485636,-1.35928357311,0.950908569014,-0.838691780268,-3.40840001958,0.51638319352,2.65425327646,0.0843548848455,-0.675982189424,-1.05584438919,-1.18290989779,0.462921760414,1.03249116217,-0.160506865943,0.489106784902,-2.22384762832,-0.864660470604,0.986551208546,-2.42389465461,0.859363790676,0.794378121261,2.62060393699,0.317710348245,2.27225778066,1.24441465539,-0.742971071222,-1.90263544147,3.90558826393,-1.87864380543,0.840540828862,-1.44010990975,-1.81518995077,0.0537526073956,2.85799997772,0.0150673746732,-2.70681290619,-1.4188978935,1.54543212208,-2.02004337627,5.97515644912,0.570951247221,-1.14496126724,1.73442891731,0.259735103681,1.15988679659,0.451798136245,-1.63816874153,-2.3556383846,2.1594153929,0.348392152217,-0.298735447643,-0.661274306338,0.446994436511,-2.37592988238,-0.754286871609,2.22145104938,3.86455626227,2.05885224414,3.14337643258,-2.69247535865,0.63040430475,-1.65053221096,2.62167021777,-3.27573531303,-1.0830372596,5.44846789165,-0.199248009565,-1.30233393949,-2.12705803034,-1.18611692499,1.09623613241,-4.51565649108,-1.24702864541,-1.26351376543,1.2536040297,0.0589707257569,-2.27417320476,2.16420429515,-0.652431204332,1.88442662255,-1.71403637549,2.72944891126,-0.103058129565,1.42052388766,-1.13649443076,-2.18410397268,1.02527742257,-0.261474260941,-3.00520731076,-1.13705020975,2.8054470199,0.106972343917,2.49261562694,-0.889421669026,-2.14240406911,-1.6587551731,1.86227454151,-0.41345196178,-1.07519468722,1.25199865844,-3.01282447887,-0.318066095596,0.278943831337,1.3039900051,-1.92468449508,2.10810585512,1.62176809984,-1.5210102932,0.65277189476,2.09601868253,-0.937046923064,0.272458316631,-0.207949695325,-1.07725556044,1.26792225512,-0.20750198555,-1.80166941375,3.37043762979,-1.88352558921,0.485364288722,-1.05039368531,-3.11558282623,1.31415114246,0.539060145076,0.774463882429,-0.91595245247,1.03091248413,1.20561219623,-0.882583885672,1.43416632686,-0.288017866226,3.24782991361,2.27741884397,-1.70607073367,-0.229781022192,-0.652251802748,2.0537759273,-0.318443989634,-1.52381514104,0.0283662636573,0.916832302223,0.0907865087156,0.875560495737,-1.25155692581,-0.0891121354863,1.69997021891,-1.16222943385,-1.33198551972,0.487758152135,0.795492940092,-0.247586458923,-1.33002045931,0.844730410997,-1.43436155383,0.593152427944,0.903109196708,-1.98483795952,-0.245508743621,-0.263292151867,-0.398590304509,-1.60388266533,-0.280547485733,-0.00237780445881,0.0193677084172,2.15677101593,2.05359130308,0.173084234495,-0.332588173198,2.65564076128,0.164489745233,3.00536162036,-1.61808904617,0.234786010929,-2.88216044132,0.611643620485,-1.64789488464,-0.165529933111,0.410880223059,0.059389048515,-0.115285487266,-0.677222777367,2.9319481803,2.07785203071,-0.702277061208,1.77347605895,-2.55880483349,1.56206742825,-0.586727318599,1.16415935108,0.416520214011,1.0611957416,3.18566023747,1.2498087893,1.75254034353,-0.342000839504,2.33598446752,2.62893465296,-0.634630568195,-1.66997562388,-1.00172801864,1.96211497785,-1.4422781786,1.65501660997,0.0831665020283,2.9614441098,-1.08523221218,1.9003329233,-4.11016008007,0.39495736094,1.49555661754,-0.670213771544,-1.15973455709,0.668605117051,1.27565883787,-3.84745876757,-1.84200837151,-2.28533133778,-4.17388448127,0.807729316842,2.19760868695,1.35008021536,0.540324197064,-0.204339000488,-2.81891192706,-1.48999154275,-1.07567275997,-1.03694026561,1.88958008701,0.350252550085,0.636217719898,0.969323297767,-2.65205768871,0.165251201587,-0.357707997339,-3.05140472954,1.00325515918,-0.966290859311,1.53969309639,-0.597303768517,-2.1401381675,2.60766354505,-2.24044694552,-1.08095369822,0.593033825481,1.15056974469,1.74209109824,-0.734770992925,0.792656986776,-1.28370983458,0.999522819389,0.101319314206,-2.03856236852,-0.801799325535,-1.44682624261,2.7958081297,1.36124727728,-0.772019462821,-0.636242644541,-0.214418585507,0.821720093976,-0.794368761603,0.43627178914

])

if __name__ == "__main__":
  root = Tk()
  root.wm_title("Developmental experiment")
  test = GUISquareLatticeTest(root, SquareLatticeWidget)
  test.mainloop()


