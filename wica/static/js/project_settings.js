// Generated by CoffeeScript 1.6.3
(function() {
  var addOption, addSection, insertOption, insertSection, optionHtml, removeOption, removeSection, sectionHtml;

  addOption = function(event) {
    var inputTag, opt, option, section;
    section = $(event.target).attr('data-section');
    inputTag = $(event.target).siblings('input[name="optionName"]').get(0);
    option = $(inputTag).val();
    if (option === "") {
      return;
    }
    console.log("Adding option " + option + " in section " + section);
    $(inputTag).val("");
    opt = optionHtml(section, option);
    return insertOption(section, opt);
  };

  addSection = function(event) {
    var inputTag, sct, section;
    inputTag = $(event.target).siblings('input[name="sectionName"]').get(0);
    console.log(inputTag);
    section = $(inputTag).val();
    if (section === "") {
      return;
    }
    console.log("adding section " + section);
    sct = sectionHtml(section);
    $(inputTag).val("");
    return insertSection(sct);
  };

  removeOption = function(event) {
    var option, section;
    section = $(event.target).attr('data-section');
    option = $(event.target).attr('data-option');
    console.log("removing " + section + "." + option);
    $("." + section + " > ." + option).fadeOut(250, function() {
      return $("." + section + " > ." + option).remove();
    });
    return $.ajax({
      type: "DELETE",
      url: ".",
      data: {
        "section": "" + section,
        "option": "" + option
      },
      success: function(response) {
        return console.log(response);
      }
    });
  };

  removeSection = function(event) {
    var section;
    section = $(event.target).attr('data-section');
    console.log("removing whole section " + section);
    $("." + section).fadeOut(250, function() {
      $("." + section).next('.ui.horizontal.icon.divider').remove();
      return $("." + section).remove();
    });
    $("." + section).next('.ui.horizontal.icon.divider').fadeOut(250);
    return $.ajax({
      type: "DELETE",
      url: ".",
      data: {
        "section": "" + section
      },
      success: function(response) {
        return console.log(response);
      }
    });
  };

  optionHtml = function(section, option) {
    return "<div class=\"field " + option + "\">\n<label>" + option + "</label>\n<div class=\"ui action input\">\n    <input type=\"text\" name=\"" + section + "." + option + "\" placeholder=\"Enter value\">\n    <div class=\"ui removeOption tiny red button\" data-option=\"" + option + "\" data-section=\"" + section + "\">\n        <i class=\"ui minus icon\"></i>\n    </div>\n</div>\n</div>";
  };

  sectionHtml = function(section) {
    return "<div class=\"ui horizontal icon divider\">\n  <i class=\"ellipsis horizontal icon\"></i>\n</div>\n<div class=\"" + section + " section\">\n\n    <h3>" + section + " <i class=\"ui remove removeSection icon\" data-section=\"" + section + "\"></i></h3>\n\n      <div class=\"ui three column grid\">\n        <div class=\"column\">\n          <div class=\"ui action input\">\n            <input type=\"text\" name=\"optionName\" placeholder=\"Option name\">\n            <div class=\"ui addOption button\" data-section=\"" + section + "\">\n                <i class=\"ui plus icon\"></i>\n            </div>\n          </div>\n        </div>\n\n      </div>";
  };

  insertOption = function(section, htmlToInsert) {
    var newOption;
    section = $("." + section);
    newOption = $(htmlToInsert);
    newOption.find(".ui.addOption.button").bind("click", addOption);
    newOption.find(".ui.removeOption.button").bind("click", removeOption);
    newOption.attr("hidden", "true");
    newOption.insertBefore(section.find(".ui.three.column.grid"));
    return newOption.fadeIn();
  };

  insertSection = function(htmlToInsert) {
    var lastSection, newSection;
    lastSection = $(".section").last();
    newSection = $(htmlToInsert);
    lastSection.after(newSection);
    newSection.fadeIn();
    newSection.find(".ui.addOption.button").bind("click", addOption);
    newSection.find(".ui.removeOption.button").bind("click", removeOption);
    return newSection.find(".ui.icon.removeSection").bind("click", removeSection);
  };

  $(document).ready(function() {
    new FormSubmitter(".ui.update.form", "PUT", ".", function(response) {
      return window.location.assign(response);
    });
    $('.addSection').bind('click', addSection);
    $('.addOption').bind('click', addOption);
    $('.removeOption').bind('click', removeOption);
    return $('.removeSection').bind('click', removeSection);
  });

}).call(this);
